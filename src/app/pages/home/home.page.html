<app-header title="Inicio" [showSignOut]="true"></app-header>

<ion-content class="home">
  @if (userDoc) {
    <h1 class="welcome-title">¡Bienvenido!</h1>

    @if (userDoc.perfil == 'propietario' || userDoc.perfil == 'supervisor') {
      <div class="section">
        <h2 class="section-title">Clientes en espera de aprobación</h2>
        <app-aprobacion-cliente></app-aprobacion-cliente>
      </div>
    }
    @else if (userDoc.perfil == 'anonimo' || userDoc.perfil == 'cliente') {
      <div class="section">
        <h2 class="section-title">Opciones:</h2>
        <app-solicitar-mesa class="action-button" [correo]="user!.email!"></app-solicitar-mesa>

        @if(userDoc.estado == 'en lista de espera') {
          <ion-button class="action-button" routerLink="/encuesta">Encuestas</ion-button>
        }
        @else if(userDoc.estado == 'mesa asignada') {
          <div class="assigned-table">
            <h2>YA TIENE MESA ASIGNADA</h2>
            
            @if(userDoc.lecturaMesa)
            {
              <p>Ahora puede acceder a las siguientes opciones:</p>
              <ion-button class="action-button" (click)="openMessageModal()">Consulta al mozo</ion-button>
              <ion-button class="action-button" routerLink="/menu">Ver Menú y realizar pedido</ion-button>
              <ion-button class="action-button">Juegos</ion-button>
            }
            @else 
            {
              <p>Escanee el código de la mesa para acceder a las siguientes opciones:</p>
              <ul class="options">
                <li>Chat con Mozo</li>
                <li>Ver Menú</li>
                <li>Juegos</li>
              </ul>
            }

          </div>
        }
      </div>
    }
    @else if (userDoc.perfil == 'maitre') {
      <div class="section">
        <h2 class="section-title">Asignación de Mesas</h2>
        <app-asignacion-mesa></app-asignacion-mesa>
      </div>
    }
    @else if (userDoc.perfil == 'mozo') {
      <div class="section">
        <h2 class="section-title">Opciones:</h2>
        <app-aprobacion-pedido></app-aprobacion-pedido>
      </div>
    }
  }
  @else {
    <app-loading></app-loading>
  }


  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeMessageModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Consulta al Mozo</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeMessageModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content class="ion-content-modal" [scrollY]="false">
        <div class="modal-container">
          <ion-item lines="none" class="centered-item">
            <ion-textarea [(ngModel)]="message" placeholder="Escribe aquí tu mensaje..."></ion-textarea>
          </ion-item>
        </div>
      </ion-content>

      <ion-footer>
        <div class="modal-actions">
          <ion-button expand="block" (click)="sendMessage()">Enviar</ion-button>
        </div>
      </ion-footer>
    </ng-template>
  </ion-modal>

</ion-content>
