<div>
  <h2>Listado de clientes con mesa</h2>
  <div>
    @if(clientesConMesa.length == 0) {
      <p>No hay clientes con mesas asignadas.</p>
    }
    @else {
      @for (cliente of clientesConMesa; track $index) {
        <ion-card class="client-card">
          <ion-card-header>
            <ion-card-title>{{ cliente.mesa }}</ion-card-title>
            @if(cliente.perfil == 'cliente') {
              <ion-card-subtitle>Cliente: {{ cliente.name }} {{ cliente.apellido }}</ion-card-subtitle>
            }
            @else {
              <ion-card-subtitle>Cliente: {{ cliente.name }}</ion-card-subtitle>
            }
          </ion-card-header>
    
          <ion-card-content>
            <p>Estado: {{ cliente.estado }}</p>
            <ion-item>
              <!-- <ion-label>Acción:</ion-label> -->
              <div class="acciones">
                @if (cliente.estado == 'mesa asignada') {
                  <p>Esperando a que el cliente realice su pedido</p>
                }
                @else if (cliente.estado == 'pedido realizado') {
                  <ion-button (click)="verPedido(cliente.idPedidoActual!)">Ver pedido</ion-button>
                }
                @else if (cliente.estado == 'pedido confirmado') {
                  <p>Esperando a que la cocina y el bar terminen de preparar el pedido</p>
                }
                @else if (cliente.estado == 'pedido terminado') {
                  <ion-button (click)="verPedidoParaLlevar(cliente.idPedidoActual!)">Ver pedido para llevar</ion-button>
                }
                @else if (cliente.estado == 'pedido entregado') {
                  @if(!cliente.recibioElPedido) {
                    <p>Esperando a que el cliente confirme la recepción del pedido</p>
                  }
                  @else {
                    <p>Esperando a que el cliente termine y solicite la cuenta</p>
                  }
                }
                @else if (cliente.estado == 'cuenta solicitada') {
                  <ion-button (click)="enviarCuenta(cliente)">Enviar cuenta</ion-button>
                }
                @else if (cliente.estado == 'cuenta enviada') {
                  <p>Esperando a que el cliente realice el pago</p>
                }
                @else if (cliente.estado == 'cuenta pagada') {
                  <ion-button (click)="liberarMesa(cliente)">Liberar mesa</ion-button>
                }
              </div>
              
            </ion-item>
          </ion-card-content>
        </ion-card>
      } 
    }
  </div>

  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button routerLink="/consultas-mozo">
      <ion-icon name="hand-right-sharp"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</div>

<!-- Modal para mostrar el pedido -->
<ion-modal [isOpen]="isModalVerPedidoOpen" (didDismiss)="cerrarModalVerPedido()">
  <ng-template>
    <ion-header>
      <ion-button color="primary" (click)="cerrarModalVerPedido()" slot="end">Cerrar</ion-button>
    </ion-header>
    <ion-content>
      @if (pedidoSeleccionado) {
        <h2 style="text-align: center;">Pedido {{ pedidoSeleccionado.mesa }}</h2>
        <div class="row-pedido">
          <div class="pedido">
            @for (producto of pedidoSeleccionado.productos; track $index) {
              <p>{{ producto.descripcion }} x {{ producto.cantidad }}</p>
            }
            <div class="row-btn">
              <ion-button (click)="aceptarPedido(pedidoSeleccionado)">Aceptar</ion-button>
              <ion-button (click)="rechazarPedido(pedidoSeleccionado)">Rechazar</ion-button>
            </div>
          </div>
        </div>
      }
    </ion-content>
  </ng-template>
</ion-modal>


<!-- Modal para mostrar el pedido para llevar -->
<ion-modal [isOpen]="isModalVerPedidoParaLlevar" (didDismiss)="cerrarModalVerPedidoParaLlevar()">
  <ng-template>
    <ion-header>
      <ion-button color="primary" (click)="cerrarModalVerPedidoParaLlevar()" slot="end">Cerrar</ion-button>
    </ion-header>
    <ion-content>
      @if (pedidoSeleccionado) {
        <h2 style="text-align: center;">Pedido {{ pedidoSeleccionado.mesa }}</h2>
        <div class="row-pedido">
          <div class="pedido">
            <h3>Productos listos:</h3>
            @for (producto of pedidoSeleccionado.productos; track $index) {
              @if ((producto.sector === 'Comidas' && pedidoSeleccionado.cocina === 'listo para servir') || 
                  (producto.sector === 'Bebidas' && pedidoSeleccionado.bar === 'listo para servir')) {
                <p>{{ producto.descripcion }} x {{ producto.cantidad }}</p>
              }
            }
            <div class="row-btn">
              <ion-button (click)="llevarPedido(pedidoSeleccionado)">Llevar a la mesa</ion-button>
            </div>
          </div>
        </div>
      }
    </ion-content>
  </ng-template>
</ion-modal>
